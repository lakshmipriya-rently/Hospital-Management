<%= stylesheet_link_tag "doctor", media: "all", "data-turbo-track": "reload" %>

<div class="container-fluid my-5">
  <div class="row min-vh-75"> 
    <!-- Sidebar / Doctor Profile -->
    <div class="col-lg-3 mb-4">
      <div class="card shadow-sm border-0 rounded-4 h-70">
        <div class="card-body text-center p-4 d-flex flex-column justify-content-between">
          <!-- Profile Image -->
          <div class="mb-3">
            <%= image_tag "doctor-profile.jpeg", class: "rounded-circle mb-3", style: "width:120px; height:120px; object-fit:cover;" %>
          </div>
          <% user = User.find_by(userable_id: @doctor.id, userable_type: "Doctor") %>
          <div>
            <h4 class="fw-bold mb-2"><%= user&.name || "N/A" %></h4>
            <p class="text-muted fs-6 mb-1"><%= user&.email || "N/A" %></p>
            <p class="text-muted fs-6"><%= user&.phone_no || "N/A" %></p>
          </div>
          <hr>
          <%= link_to edit_doctor_path(@doctor), class: "btn btn-warning w-100 mt-3" do %>
            <i class="bi bi-pencil-fill me-1"></i> Edit Profile
          <% end %>
        </div>
      </div>
    </div>

    <!-- Main Content / Appointments -->
    <div class="col-lg-9 d-flex flex-column">
      <h1 class="text-center mb-4 display-5 fw-bold text-primary border-bottom pb-3">
        Doctor's Appointments
      </h1>

      <div class="row g-4 flex-grow-1 overflow-auto">
        <% @appointments.each do |appointment| %>
          <% patient = Patient.find(appointment.patient_id) %>
          <% user = User.find_by(userable_id: appointment.patient_id, userable_type: "Patient") %>

          <div class="col-md-6 col-lg-4">
            <div class="card rounded-4 shadow-sm border-0 h-100">
              <!-- Card Header -->
              <div class="card-header text-white rounded-top-4 p-3" 
                   style="background: linear-gradient(135deg, #3A9AD9, #007BBA);">

                   
                   <h5 class="mb-0 fw-bold">üë§ <%= user.name %></h5>
                   <% if user.gender == "male" %>
                    <div class="ms-3">
                   <%= image_tag "man.avif", class: "rounded-circle", style: "width:100px; height:100px; object-fit:cover;" %>
                  </div>
                  <% else %>
                  <div class="ms-3">
                   <%= image_tag "women.avif", class: "rounded-circle", style: "width:100px; height:100px; object-fit:cover;" %>
                  </div>
                  <% end %>

                   </div>
                   
                   <!-- Card Body -->
                   <div class="card-body d-flex flex-column justify-content-between">
                   <div>
                   <p><strong>ü©∫ Disease:</strong> <%= appointment.disease %></p>
                   <p><strong>üìû Phone:</strong> <%= user.phone_no %></p>
                   <p><strong>üìÖ Date:</strong> <%= appointment.scheduled_at.strftime("%B %d, %Y") %></p>
                   <p><strong>‚è∞ Time:</strong> <%= appointment.scheduled_at.strftime("%I:%M %p") || "N/A" %></p>
                   <p>
                   <strong>üìå Status:</strong> 
                   <span class="badge 
                   <%= case appointment.status
                   when "pending" then "bg-warning text-dark"
                   when "confirmed" then "bg-success"
                   when "cancelled" then "bg-danger"
                   else "bg-info text-dark"
                   end %>">
                   <%= appointment.status.capitalize %>
                   </span>
                   </p>
                   </div>
                   
                   
   
                <!-- Status Update Form -->
                <%= form_with model: appointment, method: :patch, local: true do |f| %>
              <div class="input-group mb-3">
                <%= f.select :status, Appointment.statuses.keys.map { |s| [s.capitalize, s] }, {}, class: "form-select" %>
                <button class="btn btn-outline-primary" type="submit">Update</button>
              </div>
            <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>

  </div>
</div>
